/* empty css                  *//* empty css                   */import{h as b,P as w}from"./el-icon-37d8cfb4.js";/* empty css                     */import{I as M,M as K,a as ve,b as ge,s as S,e as ye,c as he,d as Fe}from"./notifications-e9df1fe4.js";/* empty css                  */import{f as Q,_ as Ee}from"./format-55200e38.js";import{r as d,d as Z,a as Y,K as be,L as we,M as Ce,N as Be,O as De,b as H,P as xe,m as _,h as y,i as r,w as u,F as D,Q as x,k as c,j as k,R as V,S as q,J as T,n as I,U as ke,g as X,c as Ve,E as Te}from"./index-1fdc2001.js";import{r as Ue}from"./resource_category-128c8069.js";import{c as Ae}from"./helper-48ea6d19.js";import{_ as Re}from"./plugin-vue_export-helper-b2bddca3.js";var Ne={title:"\u8D44\u6E90\u7BA1\u7406",propList:[{prop:"title",label:"\u540D\u79F0"},{prop:"category",label:"\u7C7B\u578B",slotName:"category"},{prop:"description",label:"\u63CF\u8FF0"},{prop:"target_urls",label:"\u5730\u5740",slotName:"targetUrls"},{prop:"created_time",label:"\u4E0A\u4F20\u65F6\u95F4",slotName:"createdTime"},{prop:"update_time",label:"\u66F4\u65B0\u65F6\u95F4",slotName:"updatedTime"}]};const Oe=[{type:M.input,field:"query_kw",label:"\u540D\u79F0: ",required:!1,rules:[],otherOptions:{placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",clearable:!0}},{field:"category",label:"\u7C7B\u578B: ",required:!1,rules:[],otherOptions:{placeholder:"\u8BF7\u9009\u62E9\u7C7B\u578B",clearable:!0},slotName:"category"}],U="200px",Se=[{type:M.input,field:"title",label:"\u8D44\u6E90\u540D\u79F0: ",labelWidth:U,required:!0,rules:[],otherOptions:{placeholder:"\u8BF7\u8F93\u5165\u8D44\u6E90\u540D\u79F0",clearable:!0}},{field:"category",label:"\u8D44\u6E90\u7C7B\u578B: ",required:!0,labelWidth:U,options:[],rules:[],otherOptions:{},slotName:"category"},{type:M.input,field:"description",label:"\u63CF\u8FF0: ",required:!1,labelWidth:U,rules:[],otherOptions:{placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u8BF4\u660E",clearable:!0}},{field:"target_urls",label:"\u5730\u5740: ",required:!1,labelWidth:U,rules:[],otherOptions:{placeholder:"\u8BF7\u8F93\u5165\u5730\u5740",clearable:!0},slotName:"targetUrls"}],E={list:async(s={})=>{var p;const{data:t}=await b.post(w+"/site_resource/search",s);let m=[];return(p=t==null?void 0:t.rows)==null||p.forEach(l=>{let v=l._source;v.doc_id=l._id,v.id=l._id,m.push(v)}),d({rows:m,total:t==null?void 0:t.total})},detail:async s=>{const{data:t}=await b.post(w+"/site_resource/id_search",{doc_id:s});let m=t==null?void 0:t._source;return m.doc_id=t==null?void 0:t._id,m},add:async s=>{const{data:t}=await b.post(w+"/site_resource/add",s);return t},edit:async(s,t)=>{const{data:m}=await b.post(w+"/site_resource/update",{doc_id:s,data:t});return m},del:async s=>await b.post(w+"/site_resource/delete",{doc_id:s})},qe={quark:{domain:"https://pan.quark.cn",name:"\u5938\u514B",icon:"https://pan.quark.cn/favicon.ico"},baidu:{domain:"https://pan.baidu.com",name:"\u767E\u5EA6",icon:"https://pan.baidu.com/favicon.ico"},xunlei:{domain:"https://pan.xunlei.com",name:"\u8FC5\u96F7",icon:"https://pan.xunlei.com/favicon.ico"},ali:{domain:"https://www.alipan.com",name:"\u963F\u91CC",icon:"https://www.alipan.com/favicon.ico"}},Ie=s=>{if(!(s.startsWith("http://")||s.startsWith("https://")))return"";s=s.replaceAll("http://","https://");const t=d();return Object.entries(qe).forEach(([m,p])=>{s.startsWith(p.domain)&&(t.value=p.name)}),t.value};const Me={class:"flex flex-row"},Pe=["href"],Le={class:"target-url-container"},$e={class:"items-center",style:{display:"flex","flex-direction":"row","align-items":"center","margin-bottom":"10px"}},ze=Z({name:"metaTableTest"}),We=Z({...ze,async setup(s){let t,m;const p=Y({query_kw:"",category:""}),l=d([]),v=d(),P=d([]),L=d(),g=async()=>{const a=await E.list(p);P.value=a==null?void 0:a.value.rows,L.value=a==null?void 0:a.value.total},ee=()=>{A.value=1,g()},te=async()=>{await g(),S("\u5237\u65B0\u6210\u529F")},ae=()=>{n.value={},l.value=[{target_name:"",target_url:""}],f.value=!0,R.value="\u6DFB\u52A0\u8D44\u6E90",v.value="add"},h=d(0),le=async a=>{var e;if(h.value=a.doc_id,h.value,n.value=await E.detail(a.doc_id),!n.value){ye("\u83B7\u53D6\u6570\u636E\u5931\u8D25");return}l.value=(e=n.value)==null?void 0:e.target_urls,f.value=!0,R.value="\u7F16\u8F91\u8D44\u6E90",v.value="edit"},ue=async a=>{await E.del(a),S("\u5220\u9664\u6210\u529F"),g()},oe=()=>{l.value.push({target_name:"",target_url:""})},re=a=>{l.value.length!==1&&l.value.splice(a,1)},A=d(1),$=d(10),se=a=>{A.value=a,g()},ne=a=>{$.value=a,g()},ie=Y({target_urls:[{validator:(a,e,F)=>{(!l.value||l.value.length===0||!l.value[0].target_url)&&F(new Error("\u8BF7\u8F93\u5165\u81F3\u5C11\u4E00\u4E2AURL\u5730\u5740")),l.value.forEach((C,N)=>{Ae(C.target_url)||F(new Error(`\u7B2C${N+1}\u4E2Aurl\u65E0\u6548\uFF0C\u8BF7\u8F93\u5165\u6709\u6548\u7684URL`))}),F()},trigger:"blur"}]}),z=d(),f=d(!1),R=d(""),n=d({});be(()=>f.value,()=>{!f.value&&h.value!==0&&(h.value=0)});const ce=async()=>{h.value!==0?n.value=await E.detail(h.value):n.value={}},de=async()=>{if(await z.value.validFun()){for(let e in n.value)typeof n.value[e]=="string"&&(n.value[e]=n.value[e].trim());const a=n.value;l.value.forEach(e=>{e.target_name=Ie(e.target_url)}),a.target_urls=l.value,v.value=="add"?await E.add(a):await E.edit(a.doc_id,n.value),S("\u64CD\u4F5C\u6210\u529F"),f.value=!1,g()}},W=([t,m]=we(()=>Ue.list({business_type:"resource"})),t=await t,m(),t);return g(),(a,e)=>{const F=Ce,C=Be,N=De,pe=Ve,me=H("delete"),j=Te,G=X,_e=H("Plus"),J=X,fe=xe;return _(),y("div",null,[r(c(K),{modelValue:p,"onUpdate:modelValue":e[1]||(e[1]=o=>p=o),formItems:c(Oe),onOnSearch:ee,onOnRefresh:te},{category:u(o=>[r(C,{modelValue:p.category,"onUpdate:modelValue":e[0]||(e[0]=i=>p.category=i),placeholder:"\u8BF7\u9009\u62E9\u8D44\u6E90\u7C7B\u578B",clearable:"true"},{default:u(()=>[(_(!0),y(D,null,x(c(W),i=>(_(),T(F,{label:i.category_name,value:i.category_name},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","formItems"]),r(Ee,null,{default:u(()=>[r(c(ve),{propList:c(Ne).propList,tableData:P.value,onAddData:ae,onEditData:le,onDeleteData:ue},{targetUrls:u(o=>[k("div",Me,[o.row.target_urls?(_(!0),y(D,{key:0},x(o.row.target_urls,(i,B)=>(_(),y("a",{href:i.target_url,target:"_blank",key:B,style:{"margin-left":"5px"}},[r(N,null,{default:u(()=>[I(q(i.target_name),1)]),_:2},1024)],8,Pe))),128)):V("",!0)])]),createdTime:u(o=>[k("div",null,q(c(Q)(o.row.created_at)),1)]),updatedTime:u(o=>[k("div",null,q(c(Q)(o.row.updated_at)),1)]),_:1},8,["propList","tableData"])]),_:1}),r(c(ge),{totalCount:L.value,currentPage:A.value,pageSize:$.value,onCurrentChange:se,onSizeChange:ne},null,8,["totalCount","currentPage","pageSize"]),f.value?(_(),T(ke,{key:0,to:"body"},[r(fe,{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=o=>f.value=o),title:R.value,width:"500px"},{footer:u(()=>[r(J,{onClick:e[5]||(e[5]=o=>ce()),link:""},{default:u(()=>[I("\u91CD\u7F6E")]),_:1}),r(J,{type:"primary",onClick:e[6]||(e[6]=o=>de())},{default:u(()=>[I("\u786E\u8BA4")]),_:1})]),default:u(()=>[r(c(K),{modelValue:n.value,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value=o),rules:ie,ref_key:"editFormRef",ref:z,formItems:c(Se),inline:!1,showRefresh:!1,showSearch:!1,labelWidth:"120px",labelPosition:"right"},{targetUrls:u(o=>[k("div",Le,[l.value&&l.value.length>0?(_(!0),y(D,{key:0},x(l.value,(i,B)=>(_(),y("div",$e,[r(pe,{type:"text",style:{width:"200px"},modelValue:i.target_url,"onUpdate:modelValue":O=>i.target_url=O},null,8,["modelValue","onUpdate:modelValue"]),r(G,{style:{"margin-left":"5px"},onClick:O=>re(B),color:c(he),circle:""},{default:u(()=>[r(j,{color:"#fff"},{default:u(()=>[r(me)]),_:1})]),_:2},1032,["onClick","color"]),B==0?(_(),T(G,{key:0,onClick:e[2]||(e[2]=O=>oe()),color:c(Fe),circle:"",style:{"margin-left":"5px"}},{default:u(()=>[r(j,{color:"#fff"},{default:u(()=>[r(_e)]),_:1})]),_:1},8,["color"])):V("",!0)]))),256)):V("",!0)])]),category:u(o=>[r(C,{modelValue:n.value.category,"onUpdate:modelValue":e[3]||(e[3]=i=>n.value.category=i),placeholder:"\u8BF7\u9009\u62E9\u8D44\u6E90\u7C7B\u578B",clearable:"true"},{default:u(()=>[(_(!0),y(D,null,x(c(W),i=>(_(),T(F,{label:i.category_name,value:i.category_name},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","rules","formItems"])]),_:1},8,["modelValue","title"])])):V("",!0)])}}});var lt=Re(We,[["__scopeId","data-v-1054b99d"]]);export{lt as default};
